---
title: "Visualizacion"
author: "Lucía Martínez Valderas"
date: "2024-03-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Trabajo de Visualización
```{r}
#Primero cargamos las librerías que vamos a necesitar
library(readr)
library(ggplot2)
library(plotly)
library(scales)

#A continuación cargamos el fichero de datos
owid_covid_data <- read_csv("owid-covid-data.csv")

#Primero seleccionamos los paises que vamos a utilizar en la tabla, este será nuestro nuevo data frame con el que vamos a crear la gráfica:
paises_selecionados<-c("United States","Italy","France","Germany","Canada","Japan","United Kingdom","Spain")

#para acortar la funcion, crearemos un vector asignando a su pais cada color
pais_color <- c("Spain"="red",
                "United States" = "blue",
                "Italy" = "pink",
                "France" = "green",
                "Germany" = "purple",
                "Canada" = "orange",
                "Japan" = "black",
                "United Kingdom" = "cyan")

#asignaremos a una variable los elementos del data de la columna "location" los cuales coinciden con nuestro vector "paises_seleccionados
paises<-owid_covid_data[owid_covid_data$location %in% paises_selecionados, ]

#Después en la variable de casos totales sustituimos todos los NA que aparecen por 0
#paises$new_deaths_per_million[is.na(paises$new_deaths_per_million)]<-0
```


```{r}
#Ahora representamos la gráfica:
g<- ggplot(paises,aes(x=date,y=new_deaths_smoothed_per_million, group=location))+
  geom_line(aes(colour=location),size=ifelse(paises$location == "Spain",1.5,0.5))
g
```


```{r}
#Aquí hemos ensachado la línea de España

#Ponemos como queremos que sean las fehcas en el eje x
g<- g + scale_x_date(breaks = date_breaks("1 year"),labels = scales::date_format("%b %d, %Y")) 

#Ponemos los número que queremos en el eje y
g<- g + scale_y_continuous(breaks = seq(0, 18, by = 2)) 

#scale_date_manual
#Ponemos manualmente los colores para poder reprsentar a España de rojo
g<- g + scale_color_manual(values= pais_color)

#Ponemos blanco el fondo de la gráfica
g<- g + theme_classic()

#Añadimos todos lo títulos e indicaciones a la gráfica

subtitulo <- "7-day rolling average. For some countries the number of confirmed deaths is much lower than the true number of deaths. This is because of limited
testing and challenges in the attribution of the cause of death."

g<- g + labs(title="Grupo-G",subtitle= subtitulo ,x=NULL,y=NULL,caption="Source: Johns Hopkins University CSSE COVID-19 Data")

#mostramos la grafica que hemos estado creando
show(g)

#Creamos un gráfico interactivo con la librería plotly.
g_interactivo<-ggplotly(g)
g_interactivo

```

